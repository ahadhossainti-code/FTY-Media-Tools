<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Video Downloader</title>

<style>
body{
  background:#020617;
  color:white;
  font-family:sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  width:320px;
  background:#0f172a;
  padding:20px;
  border-radius:12px;
}
input,select,button{
  width:100%;
  margin-top:10px;
  padding:10px;
  border:none;
  border-radius:8px;
}
button{
  background:#22c55e;
  font-weight:bold;
  cursor:pointer;
}
button:disabled{
  background:gray;
}
#progress{
  margin-top:10px;
  text-align:center;
}
</style>
</head>

<body>
<div class="box">
  <h3>Video Downloader</h3>

  <input id="url" placeholder="Paste video URL">

  <select id="quality">
    <option value="360">Normal (360p)</option>
    <option value="480">480p</option>
    <option value="720">720p</option>
    <option value="1080">1080p</option>
  </select>

  <button id="btn">Download</button>
  <div id="progress">0%</div>
</div>

<script>
  const btn = document.getElementById("btn");
  const progress = document.getElementById("progress");
  
  btn.onclick = async () => {
    const url = document.getElementById("url").value.trim();
    const quality = document.getElementById("quality").value;
    
    if (!url) {
      alert("URL required");
      return;
    }
    
    btn.disabled = true;
    progress.innerText = "Downloading...";
    
    try {
      // POST request to Flask backend
      const res = await fetch("/download", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url, quality })
      });
      
      if (!res.ok) {
        // backend থেকে error message নাও
        const err = await res.json();
        throw new Error(err.error || "Download failed");
      }
      
      // browser-native download
      const blob = await res.blob();
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `video_${quality}p.mp4`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      
      progress.innerText = "Completed";
      
    } catch (e) {
      alert("Download failed: " + e.message);
      progress.innerText = "Failed";
    }
    
    btn.disabled = false;
  };
</script>
</body>
</html>
